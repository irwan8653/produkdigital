<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PasarModern | Final v9 (Clean Code)</title>

    <script
      type="text/javascript"
      src="https://app.sandbox.midtrans.com/snap/snap.js"
      data-client-key="SB-Mid-client-xxxxxxxxxxxxxxxxxxxxxx"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");

      :root {
        --primary-color: #8a2be2;
        --primary-hover: #9932cc;
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --text-color: #eaeaea;
        --text-dark: #333;
        --dark-bg: #121212;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html {
        scroll-behavior: smooth;
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--dark-bg);
        color: var(--text-color);
        overflow-x: hidden;
      }
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: radial-gradient(
            circle at 15% 25%,
            #8a2be233,
            transparent 40%
          ),
          radial-gradient(circle at 85% 75%, #007bff33, transparent 40%);
        animation: aurora 20s infinite linear;
      }
      @keyframes aurora {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .cursor {
        width: 24px;
        height: 24px;
        border: 2px solid var(--primary-color);
        border-radius: 50%;
        position: fixed;
        transform: translate(-50%, -50%);
        pointer-events: none;
        transition: all 0.1s ease-out;
        z-index: 9999;
        opacity: 0;
      }
      .cursor.grow {
        transform: scale(2.5) translate(-20%, -20%);
        background-color: rgba(138, 43, 226, 0.3);
        border: none;
      }
      .container {
        max-width: 1300px;
        margin: 0 auto;
        padding: 0 20px;
      }
      .glass-effect {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 1px solid var(--glass-border);
      }
      .btn {
        padding: 1rem 2rem;
        font-size: 1rem;
        border-radius: 50px;
        background: var(--primary-color);
        color: white;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: all 0.3s;
        position: relative;
      }
      .btn:hover {
        background-color: var(--primary-hover);
      }
      .btn.loading {
        color: transparent !important;
        pointer-events: none;
      }
      .btn.loading::after {
        content: "";
        position: absolute;
        width: 24px;
        height: 24px;
        top: 50%;
        left: 50%;
        margin-top: -12px;
        margin-left: -12px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .desktop-header {
        display: flex;
        padding: 1.5rem 0;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
      }
      .logo {
        font-size: 2rem;
        font-weight: 800;
        cursor: pointer;
      }
      .main-nav {
        display: flex;
        align-items: center;
        gap: 2rem;
        padding: 0.8rem 2rem;
        border-radius: 50px;
      }
      .nav-icons a {
        font-size: 1.3rem;
        color: var(--text-color);
        position: relative;
      }
      .cart-badge {
        position: absolute;
        top: -5px;
        right: -10px;
        background-color: var(--primary-color);
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        border: 2px solid var(--dark-bg);
        font-weight: bold;
        transform: scale(0);
        transition: transform 0.2s;
      }
      .cart-badge.active {
        transform: scale(1);
      }
      .user-icon.logged-in i {
        color: var(--success-color);
      }

      .mobile-nav {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 0.5rem 1rem;
        justify-content: space-around;
        align-items: center;
        z-index: 1001;
      }
      .mobile-nav a {
        font-size: 1.5rem;
        color: var(--text-color);
        position: relative;
        padding: 0.5rem;
      }

      .view {
        display: none;
      }
      .view.active {
        display: block;
      }
      main {
        padding-top: 120px;
      }

      .hero {
        min-height: 80vh;
        display: flex;
        align-items: center;
        text-align: center;
      }
      .hero-content {
        max-width: 800px;
        margin: 0 auto;
      }
      .hero h1 {
        font-size: 4.5rem;
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 1.5rem;
      }
      .hero p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        color: #ccc;
      }

      .category-section {
        padding: 5rem 0;
      }
      .section-title {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 3rem;
        font-weight: 700;
      }
      .category-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        grid-auto-rows: 200px;
      }
      .category-card {
        border-radius: 20px;
        padding: 2rem;
        cursor: pointer;
        transition: transform 0.3s;
        position: relative;
        overflow: hidden;
      }
      .category-card:hover {
        transform: translateY(-10px);
      }
      .category-card h3 {
        font-size: 1.8rem;
        z-index: 2;
        position: relative;
      }
      .category-card i {
        font-size: 3rem;
        position: absolute;
        bottom: 1.5rem;
        right: 1.5rem;
        opacity: 0.2;
        z-index: 1;
      }
      .category-card.c-all {
        grid-column: 1 / 2;
      }
      .category-card.c-elektronik {
        grid-column: 2 / 4;
      }
      .category-card.c-fashion {
        grid-column: 1 / 3;
      }
      .category-card.c-rumah-tangga {
        grid-column: 3 / 4;
      }

      .product-section {
        padding: 5rem 0;
      }
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        perspective: 1000px;
      }
      .product-card {
        border-radius: 20px;
        overflow: hidden;
        cursor: pointer;
        position: relative;
        transition: transform 0.4s ease;
        transform-style: preserve-3d;
      }
      .product-card img {
        width: 100%;
        height: 300px;
        object-fit: cover;
      }

      .product-detail-layout {
        display: grid;
        grid-template-columns: 1fr 1.2fr;
        gap: 4rem;
        align-items: flex-start;
        padding: 4rem 0;
      }

      .modal-overlay,
      .search-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        border-radius: 20px;
        padding: 2rem;
        width: 90%;
        max-width: 500px;
        color: var(--text-dark);
        background-color: #f0f0f0;
      }
      .close-btn {
        cursor: pointer;
        border: none;
        background: none;
        font-size: 1.8rem;
      }

      .auth-form,
      .profile-view,
      .checkout-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .form-group {
        display: flex;
        flex-direction: column;
      }
      .form-group label {
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #555;
      }
      .form-group input,
      .form-group textarea {
        padding: 0.8rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1rem;
        transition: border-color 0.3s;
        background: #fff;
      }
      .form-group input.invalid,
      .form-group textarea.invalid {
        border-color: var(--danger-color);
      }
      .auth-switch {
        text-align: center;
        margin-top: 1rem;
      }
      .auth-switch a {
        color: var(--primary-color);
        cursor: pointer;
        font-weight: 600;
        text-decoration: underline;
      }

      .modal-footer {
        margin-top: 1.5rem;
        border-top: 1px solid #eee;
        padding-top: 1rem;
        text-align: right;
      }
      .checkout-summary h4 {
        margin-bottom: 1rem;
      }
      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }

      .product-card-inner {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      .product-info {
        padding: 1.5rem;
        flex-grow: 1;
      }
      .product-title {
        font-size: 1.2rem;
      }
      .product-price {
        font-size: 1.4rem;
        color: var(--primary-color);
        margin-top: auto;
      }
      .product-image-gallery img {
        width: 100%;
        border-radius: 20px;
      }
      .product-info-details .title {
        font-size: 3.5rem;
      }
      .product-info-details .price {
        font-size: 2.5rem;
      }
      .product-info-details .description {
        font-size: 1.1rem;
      }
      .detail-actions,
      .profile-view {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .profile-view span {
        font-weight: bold;
      }
      .btn-logout {
        background-color: var(--danger-color);
      }
      .quantity-selector {
        display: flex;
        align-items: center;
        background: var(--glass-bg);
        padding: 0.5rem;
        border-radius: 50px;
        max-width: 150px;
      }
      .quantity-selector button {
        background: var(--text-color);
        color: var(--dark-bg);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.5rem;
      }
      .quantity-selector input {
        background: transparent;
        border: none;
        color: var(--text-color);
        text-align: center;
        font-size: 1.2rem;
        width: 50px;
      }
      .detail-actions .btn-back {
        background: var(--glass-bg);
        color: var(--text-color);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
      }
      .modal-title {
        font-size: 1.5rem;
      }
      .cart-item {
        display: grid;
        grid-template-columns: 80px 1fr auto;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      .cart-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 12px;
      }
      .cart-item-info h4 {
        font-weight: 600;
      }
      .cart-item-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .cart-item-controls button {
        background: #ddd;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
      }
      .cart-item-controls .remove-item-btn {
        background-color: #ffdddd;
        color: #dc3545;
      }
      .cart-total {
        text-align: right;
        font-size: 1.2rem;
        font-weight: bold;
        margin-top: 2rem;
      }
      .search-overlay .close-btn {
        position: absolute;
        top: 40px;
        right: 40px;
        color: white;
      }
      .search-overlay input {
        width: 80%;
        max-width: 700px;
        padding: 1rem;
        font-size: 2rem;
        border: none;
        background: transparent;
        color: white;
        outline: none;
        text-align: center;
        border-bottom: 3px solid var(--primary-color);
      }
      #toast-container {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 3000;
      }
      .toast {
        padding: 15px 25px;
        border-radius: 50px;
        color: white;
        font-weight: 500;
      }
      .toast.success {
        background: var(--success-color);
      }
      .toast.error {
        background: var(--danger-color);
      }

      @media (max-width: 768px) {
        html {
          cursor: auto;
        }
        .cursor {
          display: none !important;
        }
        body {
          padding-bottom: 80px;
        }
        .desktop-header {
          display: none;
        }
        .mobile-nav {
          display: flex;
        }
        main {
          padding-top: 2rem;
        }
        .hero h1 {
          font-size: 2.5rem;
        }
        .category-section,
        .product-section {
          padding: 3rem 0;
        }
        .section-title {
          font-size: 2rem;
        }
        .category-grid {
          grid-template-columns: 1fr 1fr;
          grid-auto-rows: 150px;
        }
        .category-card.c-all,
        .category-card.c-elektronik,
        .category-card.c-fashion,
        .category-card.c-rumah-tangga {
          grid-column: auto;
        }
        .product-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 1rem;
        }
        .product-card img {
          height: 150px;
        }
        .product-detail-layout {
          grid-template-columns: 1fr;
          padding: 2rem 0;
        }
        .product-info-details .title {
          font-size: 2.2rem;
        }
        #toast-container {
          bottom: 90px;
        }
      }
    </style>
  </head>
  <body>
    <div class="cursor"></div>
    <header class="desktop-header glass-effect">
      <div class="container">
        <a class="logo">P.MAX</a>
        <div class="main-nav">
          <div class="nav-icons">
            <a class="icon-btn magnetic-item" id="search-btn"
              ><i class="fas fa-search"></i
            ></a>
          </div>
          <div class="nav-icons">
            <a class="icon-btn magnetic-item" id="cart-btn"
              ><i class="fas fa-shopping-cart"></i
              ><span id="cart-counter" class="cart-badge">0</span></a
            >
          </div>
          <div class="nav-icons">
            <a class="icon-btn magnetic-item user-icon" id="user-btn"
              ><i class="fas fa-user"></i
            ></a>
          </div>
        </div>
      </div>
    </header>
    <main>
      <div id="home-view" class="view active">
        <section class="hero">
          <div class="hero-content">
            <h1>Era Baru Belanja Online.</h1>
            <p>
              Temukan produk pilihan dengan pengalaman yang belum pernah Anda
              rasakan sebelumnya. Modern, cepat, dan memuaskan.
            </p>
            <a href="#category-section" class="btn">Jelajahi Kategori</a>
          </div>
        </section>
        <section id="category-section" class="category-section">
          <div class="container">
            <h2 class="section-title">Kategori</h2>
            <div class="category-grid">
              <div class="category-card c-all glass-effect" data-category="all">
                <h3>Semua</h3>
                <i class="fas fa-border-all"></i>
              </div>
              <div
                class="category-card c-elektronik glass-effect"
                data-category="elektronik"
              >
                <h3>Elektronik</h3>
                <i class="fas fa-robot"></i>
              </div>
              <div
                class="category-card c-fashion glass-effect"
                data-category="fashion"
              >
                <h3>Fashion</h3>
                <i class="fas fa-tshirt"></i>
              </div>
              <div
                class="category-card c-rumah-tangga glass-effect"
                data-category="rumah-tangga"
              >
                <h3>Rumah Tangga</h3>
                <i class="fas fa-couch"></i>
              </div>
            </div>
          </div>
        </section>
        <section class="product-section">
          <div class="container">
            <h2 class="section-title" id="product-section-title">
              Semua Produk
            </h2>
            <div class="product-grid" id="product-grid-container"></div>
          </div>
        </section>
      </div>
      <div id="detail-view" class="view">
        <div id="product-detail-content"></div>
      </div>
    </main>
    <nav class="mobile-nav glass-effect">
      <a id="mobile-home-btn"><i class="fas fa-home"></i></a
      ><a id="mobile-search-btn"><i class="fas fa-search"></i></a
      ><a id="mobile-cart-btn"
        ><i class="fas fa-shopping-cart"></i
        ><span id="mobile-cart-counter" class="cart-badge">0</span></a
      ><a class="user-icon" id="mobile-user-btn"><i class="fas fa-user"></i></a>
    </nav>
    <div id="modal-overlay" class="modal-overlay" style="display: none">
      <div id="modal-content" class="modal-content"></div>
    </div>
    <div id="search-overlay" class="search-overlay" style="display: none">
      <button class="close-btn" id="close-search-btn">&times;</button
      ><input
        type="text"
        id="search-input"
        placeholder="Ketik untuk mencari..."
      />
    </div>
    <div id="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const isTouchDevice = "ontouchstart" in window;
        const products = [
          {
            id: 1,
            title: "Smartphone Pro X",
            price: 5999000,
            category: "elektronik",
            image:
              "https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=400",
            description:
              "Smartphone canggih dengan kamera 108MP, layar Super AMOLED, dan performa gaming yang luar biasa.",
          },
          {
            id: 2,
            title: "T-Shirt Casual Premium",
            price: 150000,
            category: "fashion",
            image:
              "https://images.unsplash.com/photo-1576566588028-4147f3842f27?q=80&w=400",
            description:
              "Kaos katun premium yang nyaman dipakai sehari-hari, dengan desain minimalis dan modern.",
          },
          {
            id: 3,
            title: "Blender Multifungsi 5-Speed",
            price: 750000,
            category: "rumah-tangga",
            image:
              "https://images.unsplash.com/photo-1578643463396-997d01d44865?q=80&w=400",
            description:
              "Blender serbaguna untuk membuat jus, smoothies, dan bumbu dapur dengan 5 tingkat kecepatan.",
          },
          {
            id: 4,
            title: "Headphone Wireless Noise-Cancelling",
            price: 1200000,
            category: "elektronik",
            image:
              "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=400",
            description:
              "Nikmati musik tanpa kabel dengan kualitas suara jernih dan bass mendalam. Baterai tahan hingga 20 jam.",
          },
          {
            id: 5,
            title: "Sepatu Lari Ultra Light",
            price: 850000,
            category: "fashion",
            image:
              "https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=400",
            description:
              "Sepatu lari ringan dengan bantalan responsif, cocok untuk lari jarak jauh maupun pendek.",
          },
          {
            id: 6,
            title: "Lampu Meja Cerdas RGB",
            price: 450000,
            category: "rumah-tangga",
            image:
              "https://images.unsplash.com/photo-1543505298-b8be9b52a21a?q=80&w=400",
            description:
              "Lampu meja pintar yang bisa diatur warna dan kecerahannya melalui aplikasi smartphone.",
          },
        ];
        let cart = JSON.parse(localStorage.getItem("pmax_cart_v9")) || [];
        let currentUser =
          JSON.parse(localStorage.getItem("pmax_user_v9")) || null;

        const DOM = {
          cursor: document.querySelector(".cursor"),
          homeView: document.getElementById("home-view"),
          detailView: document.getElementById("detail-view"),
          productGrid: document.getElementById("product-grid-container"),
          productDetailContent: document.getElementById(
            "product-detail-content"
          ),
          modalOverlay: document.getElementById("modal-overlay"),
          searchOverlay: document.getElementById("search-overlay"),
          productSectionTitle: document.getElementById("product-section-title"),
          desktopCartCounter: document.getElementById("cart-counter"),
          mobileCartCounter: document.getElementById("mobile-cart-counter"),
          userIcons: document.querySelectorAll(".user-icon"),
        };

        if (!isTouchDevice) {
          document.documentElement.style.cursor = "none";
          window.addEventListener("mousemove", (e) => {
            gsap.to(DOM.cursor, {
              duration: 0.3,
              x: e.clientX,
              y: e.clientY,
              opacity: 1,
            });
          });
          document.body.addEventListener("mouseleave", () => {
            gsap.to(DOM.cursor, { duration: 0.2, opacity: 0 });
          });
          const interactiveElements = "a, button, input, .close-btn";
          document.addEventListener("mouseover", (e) => {
            e.target.closest(interactiveElements)
              ? DOM.cursor.classList.add("grow")
              : DOM.cursor.classList.remove("grow");
          });
          document.querySelectorAll(".magnetic-item").forEach((el) => {
            el.addEventListener("mousemove", (e) => {
              const { left, top, width, height } = el.getBoundingClientRect();
              gsap.to(el, {
                duration: 0.5,
                x: (e.clientX - left - width / 2) * 0.4,
                y: (e.clientY - top - height / 2) * 0.4,
              });
            });
            el.addEventListener("mouseleave", () => {
              gsap.to(el, { duration: 0.5, x: 0, y: 0 });
            });
          });
          DOM.productGrid.addEventListener("mousemove", (e) => {
            const card = e.target.closest(".product-card");
            if (card) {
              const { left, top, width, height } = card.getBoundingClientRect();
              gsap.to(card, {
                duration: 0.3,
                rotationY: ((e.clientX - left - width / 2) / width) * 20,
                rotationX: (-(e.clientY - top - height / 2) / height) * 20,
                transformPerspective: 1000,
                ease: "power2.out",
              });
            }
          });
          DOM.productGrid.addEventListener("mouseleave", () => {
            gsap.to(".product-card", {
              duration: 0.5,
              rotationY: 0,
              rotationX: 0,
              ease: "power2.out",
            });
          });
        }

        const formatRupiah = (num) =>
          new Intl.NumberFormat("id-ID", {
            style: "currency",
            currency: "IDR",
            minimumFractionDigits: 0,
          }).format(num);

        const displayProducts = (productsToShow) => {
          DOM.productGrid.innerHTML = "";
          productsToShow.forEach((product) => {
            const card = document.createElement("div");
            card.className = "product-card glass-effect";
            card.dataset.id = product.id;
            card.innerHTML = `<div class="product-card-inner"><img src="${
              product.image
            }" alt="${
              product.title
            }"><div class="product-info"><h3 class="product-title">${
              product.title
            }</h3><p class="product-price">${formatRupiah(
              product.price
            )}</p></div></div>`;
            DOM.productGrid.appendChild(card);
          });
          gsap.from(".product-card", {
            duration: 0.5,
            opacity: 0,
            y: 50,
            stagger: 0.05,
            ease: "power3.out",
          });
        };

        const showView = (viewToShow) => {
          const currentView = document.querySelector(".view.active");
          if (currentView === viewToShow && currentView) return;
          gsap.to(currentView, {
            duration: 0.4,
            autoAlpha: 0,
            onComplete: () => {
              currentView.classList.remove("active");
              viewToShow.classList.add("active");
              gsap.fromTo(
                viewToShow,
                { autoAlpha: 0, y: 30 },
                {
                  duration: 0.6,
                  autoAlpha: 1,
                  y: 0,
                  delay: 0.1,
                  ease: "power3.out",
                }
              );
              window.scrollTo(0, 0);
            },
          });
        };

        const showDetailPage = (productId) => {
          const product = products.find((p) => p.id === productId);
          if (!product) return;
          DOM.productDetailContent.innerHTML = `<div class="container"><div class="product-detail-layout"><div class="product-image-gallery"><img src="${
            product.image
          }" alt="${
            product.title
          }"></div><div class="product-info-details"><h1 class="title">${
            product.title
          }</h1><p class="price">${formatRupiah(
            product.price
          )}</p><p class="description">${
            product.description
          }</p><div class="detail-actions"><div class="quantity-selector"><button class="quantity-btn" data-action="decrease">-</button><input type="number" id="quantity-input" value="1" min="1" readonly><button class="quantity-btn" data-action="increase">+</button></div><button class="btn btn-primary" data-id="${
            product.id
          }">Tambah ke Keranjang</button><button class="btn btn-back">&larr; Kembali</button></div></div></div>`;
          showView(DOM.detailView);
        };

        const toggleOverlay = (overlay, show) => {
          gsap.to(overlay, {
            duration: 0.4,
            autoAlpha: show ? 1 : 0,
            onStart: () => {
              if (show) overlay.style.display = "flex";
            },
            onComplete: () => {
              if (!show) overlay.style.display = "none";
            },
          });
        };

        const toggleModal = (show, title = "", content = "") => {
          if (show) {
            document.getElementById(
              "modal-content"
            ).innerHTML = `<div class="modal-header"><h3 class="modal-title">${title}</h3><button class="close-btn">&times;</button></div><div class="modal-body">${content}</div>`;
          }
          toggleOverlay(DOM.modalOverlay, show);
        };

        const showToast = (message, type = "success") => {
          const toast = document.createElement("div");
          toast.className = `toast ${type}`;
          toast.textContent = message;
          document.getElementById("toast-container").appendChild(toast);
          gsap.fromTo(
            toast,
            { y: 50, opacity: 0 },
            {
              duration: 0.5,
              y: 0,
              opacity: 1,
              ease: "power3.out",
              onComplete: () => {
                gsap.to(toast, {
                  duration: 0.5,
                  opacity: 0,
                  delay: 2,
                  onComplete: () => toast.remove(),
                });
              },
            }
          );
        };

        const cartLogic = {
          syncCounters: () => {
            const totalItems = cart.reduce(
              (sum, item) => sum + item.quantity,
              0
            );
            [DOM.desktopCartCounter, DOM.mobileCartCounter].forEach(
              (counter) => {
                counter.textContent = totalItems;
                counter.classList.toggle("active", totalItems > 0);
              }
            );
          },
          save: () =>
            localStorage.setItem("pmax_cart_v9", JSON.stringify(cart)),
          add: (productId, quantity) => {
            const existing = cart.find((item) => item.id === productId);
            if (existing) existing.quantity += quantity;
            else cart.push({ id: productId, quantity });
            cartLogic.save();
            cartLogic.syncCounters();
            showToast(`${quantity}x produk ditambahkan!`, "success");
          },
          updateQuantity: (productId, newQuantity) => {
            const item = cart.find((i) => i.id === productId);
            if (item) {
              item.quantity = newQuantity;
              if (item.quantity <= 0) cartLogic.remove(productId);
              else {
                cartLogic.renderModal();
                cartLogic.save();
                cartLogic.syncCounters();
              }
            }
          },
          remove: (productId) => {
            cart = cart.filter((i) => i.id !== productId);
            cartLogic.renderModal();
            cartLogic.save();
            cartLogic.syncCounters();
          },
          renderModal: () => {
            let content = "";
            let total = 0;
            if (cart.length > 0) {
              content += cart
                .map((item) => {
                  const product = products.find((p) => p.id === item.id);
                  total += product.price * item.quantity;
                  return `<div class="cart-item"><img src="${
                    product.image
                  }" alt="${product.title}"><div class="cart-item-info"><h4>${
                    product.title
                  }</h4><p>${formatRupiah(
                    product.price
                  )}</p></div><div class="cart-item-controls"><button data-action="decrease" data-id="${
                    item.id
                  }">-</button><span>${
                    item.quantity
                  }</span><button data-action="increase" data-id="${
                    item.id
                  }">+</button><button class="remove-item-btn" data-action="remove" data-id="${
                    item.id
                  }"><i class="fas fa-trash-alt"></i></button></div></div>`;
                })
                .join("");
              content += `<div class="cart-total">Total: ${formatRupiah(
                total
              )}</div>`;
              content += `<div class="modal-footer"><button class="btn" id="checkout-btn">Checkout</button></div>`;
            } else {
              content =
                '<p style="text-align:center; padding: 2rem 0;">Keranjang belanja Anda kosong.</p>';
            }
            toggleModal(true, "Keranjang Belanja", content);
          },
        };

        const auth = {
          updateUI: () =>
            DOM.userIcons.forEach((icon) =>
              icon.classList.toggle("logged-in", !!currentUser)
            ),
          process: (form, action) => {
            const button = form.querySelector('button[type="submit"]');
            let isValid = true;
            const inputs = form.querySelectorAll("input[required]");

            inputs.forEach((input) => {
              input.classList.remove("invalid");
              if (!input.value.trim()) {
                input.classList.add("invalid");
                isValid = false;
              }
            });

            if (!isValid) {
              showToast("Harap isi semua kolom yang ditandai.", "error");
              return;
            }

            button.classList.add("loading");
            setTimeout(() => {
              const user = {
                name: form.querySelector("#register-name")?.value,
                email:
                  form.querySelector("#login-email")?.value ||
                  form.querySelector("#register-email")?.value,
              };

              if (action === "register") {
                auth.register(user, button);
              } else {
                auth.login(user, button);
              }
            }, 1000);
          },
          login: (user, button) => {
            if (!user.name) {
              user.name = user.email
                .split("@")[0]
                .replace(/\W/g, " ")
                .replace(/(^\w|\s\w)/g, (m) => m.toUpperCase());
            }
            currentUser = user;
            localStorage.setItem("pmax_user_v9", JSON.stringify(currentUser));
            auth.updateUI();
            showToast(`Selamat datang, ${user.name}!`, "success");
            if (button) button.classList.remove("loading");
            setTimeout(() => toggleModal(false), 1500);
          },
          register: (user, button) => {
            showToast(`Pendaftaran untuk ${user.name} berhasil!`, "success");
            // Automatically log in the user after registration
            auth.login(user, button);
          },
          logout: () => {
            const name = currentUser.name;
            currentUser = null;
            localStorage.removeItem("pmax_user_v9");
            auth.updateUI();
            toggleModal(false);
            showToast(`Sampai jumpa, ${name}!`);
          },
          renderLoginForm: () => {
            const content = `<form class="auth-form" id="login-form" novalidate><div class="form-group"><label for="login-email">Email</label><input type="email" id="login-email" required></div><div class="form-group"><label for="login-password">Password</label><input type="password" id="login-password" required></div><button type="submit" class="btn">Login</button><div class="auth-switch"><a id="show-register-form">Belum punya akun? Daftar</a></div></form>`;
            toggleModal(true, "Login", content);
          },
          renderRegisterForm: () => {
            const content = `<form class="auth-form" id="register-form" novalidate><div class="form-group"><label for="register-name">Nama Lengkap</label><input type="text" id="register-name" required></div><div class="form-group"><label for="register-email">Email</label><input type="email" id="register-email" required></div><div class="form-group"><label for="register-password">Password</label><input type="password" id="register-password" required></div><button type="submit" class="btn">Daftar</button><div class="auth-switch"><a id="show-login-form">Sudah punya akun? Login</a></div></form>`;
            toggleModal(true, "Daftar Akun Baru", content);
          },
          renderProfileView: () => {
            const content = `<div class="profile-view"><p>Login sebagai: <span>${currentUser.name}</span></p><p>Email: ${currentUser.email}</p><button class="btn btn-logout" id="logout-btn">Logout</button></div>`;
            toggleModal(true, "Profil Anda", content);
          },
        };

        const checkoutLogic = {
          renderForm: () => {
            if (!currentUser) {
              showToast("Harap login terlebih dahulu untuk checkout.", "error");
              auth.renderLoginForm();
              return;
            }
            let summaryHTML = "<h4>Ringkasan Pesanan</h4>";
            let total = 0;
            cart.forEach((item) => {
              const product = products.find((p) => p.id === item.id);
              total += product.price * item.quantity;
              summaryHTML += `<div class="summary-item"><span>${
                item.quantity
              }x ${product.title}</span><span>${formatRupiah(
                product.price * item.quantity
              )}</span></div>`;
            });
            summaryHTML += `<div class="summary-item"><strong>Total</strong><strong>${formatRupiah(
              total
            )}</strong></div>`;

            const content = `<form class="checkout-form" id="checkout-form" novalidate>
                    <div class="checkout-summary">${summaryHTML}</div>
                    <div class="form-group"><label for="address">Alamat Pengiriman</label><textarea id="address" rows="3" required></textarea></div>
                    <div class="form-group"><label for="phone">Nomor Telepon</label><input type="tel" id="phone" required></div>
                    <button type="submit" class="btn">Lanjutkan ke Pembayaran</button>
                    </form>`;
            toggleModal(true, "Checkout", content);
          },
          process: (form) => {
            const button = form.querySelector('button[type="submit"]');
            let isValid = true;
            form.querySelectorAll("[required]").forEach((input) => {
              input.classList.remove("invalid");
              if (!input.value.trim()) {
                isValid = false;
                input.classList.add("invalid");
              }
            });
            if (!isValid) {
              showToast("Harap lengkapi alamat dan nomor telepon.", "error");
              return;
            }

            button.classList.add("loading");

            const totalAmount = cart.reduce((sum, item) => {
              const product = products.find((p) => p.id === item.id);
              return sum + product.price * item.quantity;
            }, 0);

            const orderData = {
              orderId: "ORDER-" + new Date().getTime(),
              totalAmount: totalAmount,
              customerDetails: {
                name: currentUser.name,
                email: currentUser.email,
                phone: form.querySelector("#phone").value,
              },
            };

            fetch("http://localhost:3000/create-transaction", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(orderData),
            })
              .then((response) => response.json())
              .then((data) => {
                button.classList.remove("loading");
                if (data.token) {
                  window.snap.pay(data.token, {
                    onSuccess: function (result) {
                      showToast("Pembayaran Berhasil!", "success");
                      cart = [];
                      cartLogic.save();
                      cartLogic.syncCounters();
                      toggleModal(false);
                    },
                    onPending: function (result) {
                      showToast("Menunggu Pembayaran Anda...");
                      toggleModal(false);
                    },
                    onError: function (result) {
                      showToast("Pembayaran Gagal.", "error");
                    },
                    onClose: function () {
                      /* User closed the popup */
                    },
                  });
                } else {
                  showToast("Gagal memproses pembayaran.", "error");
                }
              })
              .catch((error) => {
                button.classList.remove("loading");
                toggleModal(false);
                setTimeout(() => {
                  toggleModal(
                    true,
                    "Simulasi Gagal",
                    '<p style="text-align:center; padding: 1rem 0;">Gagal terhubung ke server backend. Pastikan server `node server.js` Anda sudah berjalan. Halaman pembayaran Midtrans tidak dapat ditampilkan.</p>'
                  );
                }, 500);
                console.error("Error connecting to backend:", error);
              });
          },
        };

        document.body.addEventListener("click", (e) => {
          const delegate = (selector, fn) => {
            if (e.target.closest(selector)) fn(e.target.closest(selector));
          };

          if (e.target.matches("#modal-overlay")) {
            toggleModal(false);
            return;
          }

          delegate(".close-btn", () => toggleModal(false));
          delegate(".logo, #mobile-home-btn", () => showView(DOM.homeView));
          delegate(".product-card", (el) =>
            showDetailPage(parseInt(el.dataset.id))
          );
          delegate(".btn-back", () => showView(DOM.homeView));
          delegate(".detail-actions .btn-primary", (el) =>
            cartLogic.add(
              parseInt(el.dataset.id),
              parseInt(document.getElementById("quantity-input").value)
            )
          );
          delegate(".quantity-btn", (el) => {
            const input = el.parentElement.querySelector("input");
            let value = parseInt(input.value);
            if (el.dataset.action === "increase") value++;
            if (el.dataset.action === "decrease" && value > 1) value--;
            input.value = value;
          });
          delegate(".category-card", (el) => {
            DOM.productSectionTitle.textContent =
              el.querySelector("h3").textContent;
            displayProducts(
              el.dataset.category === "all"
                ? products
                : products.filter((p) => p.category === el.dataset.category)
            );
            document.querySelector(".product-section").scrollIntoView();
          });
          delegate("#search-btn, #mobile-search-btn", () =>
            toggleOverlay(document.getElementById("search-overlay"), true)
          );
          delegate("#close-search-btn", () =>
            toggleOverlay(document.getElementById("search-overlay"), false)
          );
          delegate("#cart-btn, #mobile-cart-btn", cartLogic.renderModal);
          delegate("#user-btn, #mobile-user-btn", () =>
            currentUser ? auth.renderProfileView() : auth.renderLoginForm()
          );
          delegate("#show-register-form", auth.renderRegisterForm);
          delegate("#show-login-form", auth.renderLoginForm);
          delegate("#logout-btn", auth.logout);
          delegate("#checkout-btn", checkoutLogic.renderForm);

          const cartActionTarget = e.target.closest(
            ".cart-item-controls button"
          );
          if (cartActionTarget) {
            const id = parseInt(cartActionTarget.dataset.id);
            const action = cartActionTarget.dataset.action;
            const item = cart.find((i) => i.id === id);
            if (action === "increase" && item)
              cartLogic.updateQuantity(id, item.quantity + 1);
            if (action === "decrease" && item)
              cartLogic.updateQuantity(id, item.quantity - 1);
            if (action === "remove") cartLogic.remove(id);
          }
        });

        document.body.addEventListener("submit", (e) => {
          e.preventDefault();
          if (e.target.id === "login-form") auth.process(e.target, "login");
          if (e.target.id === "register-form")
            auth.process(e.target, "register");
          if (e.target.id === "checkout-form") checkoutLogic.process(e.target);
        });

        document
          .getElementById("search-input")
          .addEventListener("input", (e) => {
            const term = e.target.value.toLowerCase();
            displayProducts(
              products.filter((p) => p.title.toLowerCase().includes(term))
            );
            if (DOM.detailView.classList.contains("active"))
              showView(DOM.homeView);
            document.querySelector(".product-section").scrollIntoView();
          });

        displayProducts(products);
        showView(DOM.homeView);
        gsap.set(DOM.homeView, { autoAlpha: 1 });
        gsap.from(".desktop-header", {
          duration: 1,
          y: -100,
          opacity: 0,
          ease: "power3.out",
        });
        gsap.from(".hero-content > *", {
          duration: 1,
          y: 50,
          opacity: 0,
          stagger: 0.2,
          delay: 0.5,
          ease: "power3.out",
        });
        auth.updateUI();
        cartLogic.syncCounters();
      });
    </script>
  </body>
</html>
=======
<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PasarModern | Final v9 (Clean Code)</title>

    <script
      type="text/javascript"
      src="https://app.sandbox.midtrans.com/snap/snap.js"
      data-client-key="SB-Mid-client-xxxxxxxxxxxxxxxxxxxxxx"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");

      :root {
        --primary-color: #8a2be2;
        --primary-hover: #9932cc;
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --text-color: #eaeaea;
        --text-dark: #333;
        --dark-bg: #121212;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html {
        scroll-behavior: smooth;
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--dark-bg);
        color: var(--text-color);
        overflow-x: hidden;
      }
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: radial-gradient(
            circle at 15% 25%,
            #8a2be233,
            transparent 40%
          ),
          radial-gradient(circle at 85% 75%, #007bff33, transparent 40%);
        animation: aurora 20s infinite linear;
      }
      @keyframes aurora {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .cursor {
        width: 24px;
        height: 24px;
        border: 2px solid var(--primary-color);
        border-radius: 50%;
        position: fixed;
        transform: translate(-50%, -50%);
        pointer-events: none;
        transition: all 0.1s ease-out;
        z-index: 9999;
        opacity: 0;
      }
      .cursor.grow {
        transform: scale(2.5) translate(-20%, -20%);
        background-color: rgba(138, 43, 226, 0.3);
        border: none;
      }
      .container {
        max-width: 1300px;
        margin: 0 auto;
        padding: 0 20px;
      }
      .glass-effect {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 1px solid var(--glass-border);
      }
      .btn {
        padding: 1rem 2rem;
        font-size: 1rem;
        border-radius: 50px;
        background: var(--primary-color);
        color: white;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: all 0.3s;
        position: relative;
      }
      .btn:hover {
        background-color: var(--primary-hover);
      }
      .btn.loading {
        color: transparent !important;
        pointer-events: none;
      }
      .btn.loading::after {
        content: "";
        position: absolute;
        width: 24px;
        height: 24px;
        top: 50%;
        left: 50%;
        margin-top: -12px;
        margin-left: -12px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .desktop-header {
        display: flex;
        padding: 1.5rem 0;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
      }
      .logo {
        font-size: 2rem;
        font-weight: 800;
        cursor: pointer;
      }
      .main-nav {
        display: flex;
        align-items: center;
        gap: 2rem;
        padding: 0.8rem 2rem;
        border-radius: 50px;
      }
      .nav-icons a {
        font-size: 1.3rem;
        color: var(--text-color);
        position: relative;
      }
      .cart-badge {
        position: absolute;
        top: -5px;
        right: -10px;
        background-color: var(--primary-color);
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        border: 2px solid var(--dark-bg);
        font-weight: bold;
        transform: scale(0);
        transition: transform 0.2s;
      }
      .cart-badge.active {
        transform: scale(1);
      }
      .user-icon.logged-in i {
        color: var(--success-color);
      }

      .mobile-nav {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 0.5rem 1rem;
        justify-content: space-around;
        align-items: center;
        z-index: 1001;
      }
      .mobile-nav a {
        font-size: 1.5rem;
        color: var(--text-color);
        position: relative;
        padding: 0.5rem;
      }

      .view {
        display: none;
      }
      .view.active {
        display: block;
      }
      main {
        padding-top: 120px;
      }

      .hero {
        min-height: 80vh;
        display: flex;
        align-items: center;
        text-align: center;
      }
      .hero-content {
        max-width: 800px;
        margin: 0 auto;
      }
      .hero h1 {
        font-size: 4.5rem;
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 1.5rem;
      }
      .hero p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        color: #ccc;
      }

      .category-section {
        padding: 5rem 0;
      }
      .section-title {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 3rem;
        font-weight: 700;
      }
      .category-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        grid-auto-rows: 200px;
      }
      .category-card {
        border-radius: 20px;
        padding: 2rem;
        cursor: pointer;
        transition: transform 0.3s;
        position: relative;
        overflow: hidden;
      }
      .category-card:hover {
        transform: translateY(-10px);
      }
      .category-card h3 {
        font-size: 1.8rem;
        z-index: 2;
        position: relative;
      }
      .category-card i {
        font-size: 3rem;
        position: absolute;
        bottom: 1.5rem;
        right: 1.5rem;
        opacity: 0.2;
        z-index: 1;
      }
      .category-card.c-all {
        grid-column: 1 / 2;
      }
      .category-card.c-elektronik {
        grid-column: 2 / 4;
      }
      .category-card.c-fashion {
        grid-column: 1 / 3;
      }
      .category-card.c-rumah-tangga {
        grid-column: 3 / 4;
      }

      .product-section {
        padding: 5rem 0;
      }
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        perspective: 1000px;
      }
      .product-card {
        border-radius: 20px;
        overflow: hidden;
        cursor: pointer;
        position: relative;
        transition: transform 0.4s ease;
        transform-style: preserve-3d;
      }
      .product-card img {
        width: 100%;
        height: 300px;
        object-fit: cover;
      }

      .product-detail-layout {
        display: grid;
        grid-template-columns: 1fr 1.2fr;
        gap: 4rem;
        align-items: flex-start;
        padding: 4rem 0;
      }

      .modal-overlay,
      .search-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        border-radius: 20px;
        padding: 2rem;
        width: 90%;
        max-width: 500px;
        color: var(--text-dark);
        background-color: #f0f0f0;
      }
      .close-btn {
        cursor: pointer;
        border: none;
        background: none;
        font-size: 1.8rem;
      }

      .auth-form,
      .profile-view,
      .checkout-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .form-group {
        display: flex;
        flex-direction: column;
      }
      .form-group label {
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #555;
      }
      .form-group input,
      .form-group textarea {
        padding: 0.8rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1rem;
        transition: border-color 0.3s;
        background: #fff;
      }
      .form-group input.invalid,
      .form-group textarea.invalid {
        border-color: var(--danger-color);
      }
      .auth-switch {
        text-align: center;
        margin-top: 1rem;
      }
      .auth-switch a {
        color: var(--primary-color);
        cursor: pointer;
        font-weight: 600;
        text-decoration: underline;
      }

      .modal-footer {
        margin-top: 1.5rem;
        border-top: 1px solid #eee;
        padding-top: 1rem;
        text-align: right;
      }
      .checkout-summary h4 {
        margin-bottom: 1rem;
      }
      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }

      .product-card-inner {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      .product-info {
        padding: 1.5rem;
        flex-grow: 1;
      }
      .product-title {
        font-size: 1.2rem;
      }
      .product-price {
        font-size: 1.4rem;
        color: var(--primary-color);
        margin-top: auto;
      }
      .product-image-gallery img {
        width: 100%;
        border-radius: 20px;
      }
      .product-info-details .title {
        font-size: 3.5rem;
      }
      .product-info-details .price {
        font-size: 2.5rem;
      }
      .product-info-details .description {
        font-size: 1.1rem;
      }
      .detail-actions,
      .profile-view {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .profile-view span {
        font-weight: bold;
      }
      .btn-logout {
        background-color: var(--danger-color);
      }
      .quantity-selector {
        display: flex;
        align-items: center;
        background: var(--glass-bg);
        padding: 0.5rem;
        border-radius: 50px;
        max-width: 150px;
      }
      .quantity-selector button {
        background: var(--text-color);
        color: var(--dark-bg);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.5rem;
      }
      .quantity-selector input {
        background: transparent;
        border: none;
        color: var(--text-color);
        text-align: center;
        font-size: 1.2rem;
        width: 50px;
      }
      .detail-actions .btn-back {
        background: var(--glass-bg);
        color: var(--text-color);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
      }
      .modal-title {
        font-size: 1.5rem;
      }
      .cart-item {
        display: grid;
        grid-template-columns: 80px 1fr auto;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      .cart-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 12px;
      }
      .cart-item-info h4 {
        font-weight: 600;
      }
      .cart-item-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .cart-item-controls button {
        background: #ddd;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
      }
      .cart-item-controls .remove-item-btn {
        background-color: #ffdddd;
        color: #dc3545;
      }
      .cart-total {
        text-align: right;
        font-size: 1.2rem;
        font-weight: bold;
        margin-top: 2rem;
      }
      .search-overlay .close-btn {
        position: absolute;
        top: 40px;
        right: 40px;
        color: white;
      }
      .search-overlay input {
        width: 80%;
        max-width: 700px;
        padding: 1rem;
        font-size: 2rem;
        border: none;
        background: transparent;
        color: white;
        outline: none;
        text-align: center;
        border-bottom: 3px solid var(--primary-color);
      }
      #toast-container {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 3000;
      }
      .toast {
        padding: 15px 25px;
        border-radius: 50px;
        color: white;
        font-weight: 500;
      }
      .toast.success {
        background: var(--success-color);
      }
      .toast.error {
        background: var(--danger-color);
      }

      @media (max-width: 768px) {
        html {
          cursor: auto;
        }
        .cursor {
          display: none !important;
        }
        body {
          padding-bottom: 80px;
        }
        .desktop-header {
          display: none;
        }
        .mobile-nav {
          display: flex;
        }
        main {
          padding-top: 2rem;
        }
        .hero h1 {
          font-size: 2.5rem;
        }
        .category-section,
        .product-section {
          padding: 3rem 0;
        }
        .section-title {
          font-size: 2rem;
        }
        .category-grid {
          grid-template-columns: 1fr 1fr;
          grid-auto-rows: 150px;
        }
        .category-card.c-all,
        .category-card.c-elektronik,
        .category-card.c-fashion,
        .category-card.c-rumah-tangga {
          grid-column: auto;
        }
        .product-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 1rem;
        }
        .product-card img {
          height: 150px;
        }
        .product-detail-layout {
          grid-template-columns: 1fr;
          padding: 2rem 0;
        }
        .product-info-details .title {
          font-size: 2.2rem;
        }
        #toast-container {
          bottom: 90px;
        }
      }
    </style>
  </head>
  <body>
    <div class="cursor"></div>
    <header class="desktop-header glass-effect">
      <div class="container">
        <a class="logo">P.MAX</a>
        <div class="main-nav">
          <div class="nav-icons">
            <a class="icon-btn magnetic-item" id="search-btn"
              ><i class="fas fa-search"></i
            ></a>
          </div>
          <div class="nav-icons">
            <a class="icon-btn magnetic-item" id="cart-btn"
              ><i class="fas fa-shopping-cart"></i
              ><span id="cart-counter" class="cart-badge">0</span></a
            >
          </div>
          <div class="nav-icons">
            <a class="icon-btn magnetic-item user-icon" id="user-btn"
              ><i class="fas fa-user"></i
            ></a>
          </div>
        </div>
      </div>
    </header>
    <main>
      <div id="home-view" class="view active">
        <section class="hero">
          <div class="hero-content">
            <h1>Era Baru Belanja Online.</h1>
            <p>
              Temukan produk pilihan dengan pengalaman yang belum pernah Anda
              rasakan sebelumnya. Modern, cepat, dan memuaskan.
            </p>
            <a href="#category-section" class="btn">Jelajahi Kategori</a>
          </div>
        </section>
        <section id="category-section" class="category-section">
          <div class="container">
            <h2 class="section-title">Kategori</h2>
            <div class="category-grid">
              <div class="category-card c-all glass-effect" data-category="all">
                <h3>Semua</h3>
                <i class="fas fa-border-all"></i>
              </div>
              <div
                class="category-card c-elektronik glass-effect"
                data-category="elektronik"
              >
                <h3>Elektronik</h3>
                <i class="fas fa-robot"></i>
              </div>
              <div
                class="category-card c-fashion glass-effect"
                data-category="fashion"
              >
                <h3>Fashion</h3>
                <i class="fas fa-tshirt"></i>
              </div>
              <div
                class="category-card c-rumah-tangga glass-effect"
                data-category="rumah-tangga"
              >
                <h3>Rumah Tangga</h3>
                <i class="fas fa-couch"></i>
              </div>
            </div>
          </div>
        </section>
        <section class="product-section">
          <div class="container">
            <h2 class="section-title" id="product-section-title">
              Semua Produk
            </h2>
            <div class="product-grid" id="product-grid-container"></div>
          </div>
        </section>
      </div>
      <div id="detail-view" class="view">
        <div id="product-detail-content"></div>
      </div>
    </main>
    <nav class="mobile-nav glass-effect">
      <a id="mobile-home-btn"><i class="fas fa-home"></i></a
      ><a id="mobile-search-btn"><i class="fas fa-search"></i></a
      ><a id="mobile-cart-btn"
        ><i class="fas fa-shopping-cart"></i
        ><span id="mobile-cart-counter" class="cart-badge">0</span></a
      ><a class="user-icon" id="mobile-user-btn"><i class="fas fa-user"></i></a>
    </nav>
    <div id="modal-overlay" class="modal-overlay" style="display: none">
      <div id="modal-content" class="modal-content"></div>
    </div>
    <div id="search-overlay" class="search-overlay" style="display: none">
      <button class="close-btn" id="close-search-btn">&times;</button
      ><input
        type="text"
        id="search-input"
        placeholder="Ketik untuk mencari..."
      />
    </div>
    <div id="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const isTouchDevice = "ontouchstart" in window;
        const products = [
          {
            id: 1,
            title: "Smartphone Pro X",
            price: 5999000,
            category: "elektronik",
            image:
              "https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=400",
            description:
              "Smartphone canggih dengan kamera 108MP, layar Super AMOLED, dan performa gaming yang luar biasa.",
          },
          {
            id: 2,
            title: "T-Shirt Casual Premium",
            price: 150000,
            category: "fashion",
            image:
              "https://images.unsplash.com/photo-1576566588028-4147f3842f27?q=80&w=400",
            description:
              "Kaos katun premium yang nyaman dipakai sehari-hari, dengan desain minimalis dan modern.",
          },
          {
            id: 3,
            title: "Blender Multifungsi 5-Speed",
            price: 750000,
            category: "rumah-tangga",
            image:
              "https://images.unsplash.com/photo-1578643463396-997d01d44865?q=80&w=400",
            description:
              "Blender serbaguna untuk membuat jus, smoothies, dan bumbu dapur dengan 5 tingkat kecepatan.",
          },
          {
            id: 4,
            title: "Headphone Wireless Noise-Cancelling",
            price: 1200000,
            category: "elektronik",
            image:
              "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=400",
            description:
              "Nikmati musik tanpa kabel dengan kualitas suara jernih dan bass mendalam. Baterai tahan hingga 20 jam.",
          },
          {
            id: 5,
            title: "Sepatu Lari Ultra Light",
            price: 850000,
            category: "fashion",
            image:
              "https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=400",
            description:
              "Sepatu lari ringan dengan bantalan responsif, cocok untuk lari jarak jauh maupun pendek.",
          },
          {
            id: 6,
            title: "Lampu Meja Cerdas RGB",
            price: 450000,
            category: "rumah-tangga",
            image:
              "https://images.unsplash.com/photo-1543505298-b8be9b52a21a?q=80&w=400",
            description:
              "Lampu meja pintar yang bisa diatur warna dan kecerahannya melalui aplikasi smartphone.",
          },
        ];
        let cart = JSON.parse(localStorage.getItem("pmax_cart_v9")) || [];
        let currentUser =
          JSON.parse(localStorage.getItem("pmax_user_v9")) || null;

        const DOM = {
          cursor: document.querySelector(".cursor"),
          homeView: document.getElementById("home-view"),
          detailView: document.getElementById("detail-view"),
          productGrid: document.getElementById("product-grid-container"),
          productDetailContent: document.getElementById(
            "product-detail-content"
          ),
          modalOverlay: document.getElementById("modal-overlay"),
          searchOverlay: document.getElementById("search-overlay"),
          productSectionTitle: document.getElementById("product-section-title"),
          desktopCartCounter: document.getElementById("cart-counter"),
          mobileCartCounter: document.getElementById("mobile-cart-counter"),
          userIcons: document.querySelectorAll(".user-icon"),
        };

        if (!isTouchDevice) {
          document.documentElement.style.cursor = "none";
          window.addEventListener("mousemove", (e) => {
            gsap.to(DOM.cursor, {
              duration: 0.3,
              x: e.clientX,
              y: e.clientY,
              opacity: 1,
            });
          });
          document.body.addEventListener("mouseleave", () => {
            gsap.to(DOM.cursor, { duration: 0.2, opacity: 0 });
          });
          const interactiveElements = "a, button, input, .close-btn";
          document.addEventListener("mouseover", (e) => {
            e.target.closest(interactiveElements)
              ? DOM.cursor.classList.add("grow")
              : DOM.cursor.classList.remove("grow");
          });
          document.querySelectorAll(".magnetic-item").forEach((el) => {
            el.addEventListener("mousemove", (e) => {
              const { left, top, width, height } = el.getBoundingClientRect();
              gsap.to(el, {
                duration: 0.5,
                x: (e.clientX - left - width / 2) * 0.4,
                y: (e.clientY - top - height / 2) * 0.4,
              });
            });
            el.addEventListener("mouseleave", () => {
              gsap.to(el, { duration: 0.5, x: 0, y: 0 });
            });
          });
          DOM.productGrid.addEventListener("mousemove", (e) => {
            const card = e.target.closest(".product-card");
            if (card) {
              const { left, top, width, height } = card.getBoundingClientRect();
              gsap.to(card, {
                duration: 0.3,
                rotationY: ((e.clientX - left - width / 2) / width) * 20,
                rotationX: (-(e.clientY - top - height / 2) / height) * 20,
                transformPerspective: 1000,
                ease: "power2.out",
              });
            }
          });
          DOM.productGrid.addEventListener("mouseleave", () => {
            gsap.to(".product-card", {
              duration: 0.5,
              rotationY: 0,
              rotationX: 0,
              ease: "power2.out",
            });
          });
        }

        const formatRupiah = (num) =>
          new Intl.NumberFormat("id-ID", {
            style: "currency",
            currency: "IDR",
            minimumFractionDigits: 0,
          }).format(num);

        const displayProducts = (productsToShow) => {
          DOM.productGrid.innerHTML = "";
          productsToShow.forEach((product) => {
            const card = document.createElement("div");
            card.className = "product-card glass-effect";
            card.dataset.id = product.id;
            card.innerHTML = `<div class="product-card-inner"><img src="${
              product.image
            }" alt="${
              product.title
            }"><div class="product-info"><h3 class="product-title">${
              product.title
            }</h3><p class="product-price">${formatRupiah(
              product.price
            )}</p></div></div>`;
            DOM.productGrid.appendChild(card);
          });
          gsap.from(".product-card", {
            duration: 0.5,
            opacity: 0,
            y: 50,
            stagger: 0.05,
            ease: "power3.out",
          });
        };

        const showView = (viewToShow) => {
          const currentView = document.querySelector(".view.active");
          if (currentView === viewToShow && currentView) return;
          gsap.to(currentView, {
            duration: 0.4,
            autoAlpha: 0,
            onComplete: () => {
              currentView.classList.remove("active");
              viewToShow.classList.add("active");
              gsap.fromTo(
                viewToShow,
                { autoAlpha: 0, y: 30 },
                {
                  duration: 0.6,
                  autoAlpha: 1,
                  y: 0,
                  delay: 0.1,
                  ease: "power3.out",
                }
              );
              window.scrollTo(0, 0);
            },
          });
        };

        const showDetailPage = (productId) => {
          const product = products.find((p) => p.id === productId);
          if (!product) return;
          DOM.productDetailContent.innerHTML = `<div class="container"><div class="product-detail-layout"><div class="product-image-gallery"><img src="${
            product.image
          }" alt="${
            product.title
          }"></div><div class="product-info-details"><h1 class="title">${
            product.title
          }</h1><p class="price">${formatRupiah(
            product.price
          )}</p><p class="description">${
            product.description
          }</p><div class="detail-actions"><div class="quantity-selector"><button class="quantity-btn" data-action="decrease">-</button><input type="number" id="quantity-input" value="1" min="1" readonly><button class="quantity-btn" data-action="increase">+</button></div><button class="btn btn-primary" data-id="${
            product.id
          }">Tambah ke Keranjang</button><button class="btn btn-back">&larr; Kembali</button></div></div></div>`;
          showView(DOM.detailView);
        };

        const toggleOverlay = (overlay, show) => {
          gsap.to(overlay, {
            duration: 0.4,
            autoAlpha: show ? 1 : 0,
            onStart: () => {
              if (show) overlay.style.display = "flex";
            },
            onComplete: () => {
              if (!show) overlay.style.display = "none";
            },
          });
        };

        const toggleModal = (show, title = "", content = "") => {
          if (show) {
            document.getElementById(
              "modal-content"
            ).innerHTML = `<div class="modal-header"><h3 class="modal-title">${title}</h3><button class="close-btn">&times;</button></div><div class="modal-body">${content}</div>`;
          }
          toggleOverlay(DOM.modalOverlay, show);
        };

        const showToast = (message, type = "success") => {
          const toast = document.createElement("div");
          toast.className = `toast ${type}`;
          toast.textContent = message;
          document.getElementById("toast-container").appendChild(toast);
          gsap.fromTo(
            toast,
            { y: 50, opacity: 0 },
            {
              duration: 0.5,
              y: 0,
              opacity: 1,
              ease: "power3.out",
              onComplete: () => {
                gsap.to(toast, {
                  duration: 0.5,
                  opacity: 0,
                  delay: 2,
                  onComplete: () => toast.remove(),
                });
              },
            }
          );
        };

        const cartLogic = {
          syncCounters: () => {
            const totalItems = cart.reduce(
              (sum, item) => sum + item.quantity,
              0
            );
            [DOM.desktopCartCounter, DOM.mobileCartCounter].forEach(
              (counter) => {
                counter.textContent = totalItems;
                counter.classList.toggle("active", totalItems > 0);
              }
            );
          },
          save: () =>
            localStorage.setItem("pmax_cart_v9", JSON.stringify(cart)),
          add: (productId, quantity) => {
            const existing = cart.find((item) => item.id === productId);
            if (existing) existing.quantity += quantity;
            else cart.push({ id: productId, quantity });
            cartLogic.save();
            cartLogic.syncCounters();
            showToast(`${quantity}x produk ditambahkan!`, "success");
          },
          updateQuantity: (productId, newQuantity) => {
            const item = cart.find((i) => i.id === productId);
            if (item) {
              item.quantity = newQuantity;
              if (item.quantity <= 0) cartLogic.remove(productId);
              else {
                cartLogic.renderModal();
                cartLogic.save();
                cartLogic.syncCounters();
              }
            }
          },
          remove: (productId) => {
            cart = cart.filter((i) => i.id !== productId);
            cartLogic.renderModal();
            cartLogic.save();
            cartLogic.syncCounters();
          },
          renderModal: () => {
            let content = "";
            let total = 0;
            if (cart.length > 0) {
              content += cart
                .map((item) => {
                  const product = products.find((p) => p.id === item.id);
                  total += product.price * item.quantity;
                  return `<div class="cart-item"><img src="${
                    product.image
                  }" alt="${product.title}"><div class="cart-item-info"><h4>${
                    product.title
                  }</h4><p>${formatRupiah(
                    product.price
                  )}</p></div><div class="cart-item-controls"><button data-action="decrease" data-id="${
                    item.id
                  }">-</button><span>${
                    item.quantity
                  }</span><button data-action="increase" data-id="${
                    item.id
                  }">+</button><button class="remove-item-btn" data-action="remove" data-id="${
                    item.id
                  }"><i class="fas fa-trash-alt"></i></button></div></div>`;
                })
                .join("");
              content += `<div class="cart-total">Total: ${formatRupiah(
                total
              )}</div>`;
              content += `<div class="modal-footer"><button class="btn" id="checkout-btn">Checkout</button></div>`;
            } else {
              content =
                '<p style="text-align:center; padding: 2rem 0;">Keranjang belanja Anda kosong.</p>';
            }
            toggleModal(true, "Keranjang Belanja", content);
          },
        };

        const auth = {
          updateUI: () =>
            DOM.userIcons.forEach((icon) =>
              icon.classList.toggle("logged-in", !!currentUser)
            ),
          process: (form, action) => {
            const button = form.querySelector('button[type="submit"]');
            let isValid = true;
            const inputs = form.querySelectorAll("input[required]");

            inputs.forEach((input) => {
              input.classList.remove("invalid");
              if (!input.value.trim()) {
                input.classList.add("invalid");
                isValid = false;
              }
            });

            if (!isValid) {
              showToast("Harap isi semua kolom yang ditandai.", "error");
              return;
            }

            button.classList.add("loading");
            setTimeout(() => {
              const user = {
                name: form.querySelector("#register-name")?.value,
                email:
                  form.querySelector("#login-email")?.value ||
                  form.querySelector("#register-email")?.value,
              };

              if (action === "register") {
                auth.register(user, button);
              } else {
                auth.login(user, button);
              }
            }, 1000);
          },
          login: (user, button) => {
            if (!user.name) {
              user.name = user.email
                .split("@")[0]
                .replace(/\W/g, " ")
                .replace(/(^\w|\s\w)/g, (m) => m.toUpperCase());
            }
            currentUser = user;
            localStorage.setItem("pmax_user_v9", JSON.stringify(currentUser));
            auth.updateUI();
            showToast(`Selamat datang, ${user.name}!`, "success");
            if (button) button.classList.remove("loading");
            setTimeout(() => toggleModal(false), 1500);
          },
          register: (user, button) => {
            showToast(`Pendaftaran untuk ${user.name} berhasil!`, "success");
            // Automatically log in the user after registration
            auth.login(user, button);
          },
          logout: () => {
            const name = currentUser.name;
            currentUser = null;
            localStorage.removeItem("pmax_user_v9");
            auth.updateUI();
            toggleModal(false);
            showToast(`Sampai jumpa, ${name}!`);
          },
          renderLoginForm: () => {
            const content = `<form class="auth-form" id="login-form" novalidate><div class="form-group"><label for="login-email">Email</label><input type="email" id="login-email" required></div><div class="form-group"><label for="login-password">Password</label><input type="password" id="login-password" required></div><button type="submit" class="btn">Login</button><div class="auth-switch"><a id="show-register-form">Belum punya akun? Daftar</a></div></form>`;
            toggleModal(true, "Login", content);
          },
          renderRegisterForm: () => {
            const content = `<form class="auth-form" id="register-form" novalidate><div class="form-group"><label for="register-name">Nama Lengkap</label><input type="text" id="register-name" required></div><div class="form-group"><label for="register-email">Email</label><input type="email" id="register-email" required></div><div class="form-group"><label for="register-password">Password</label><input type="password" id="register-password" required></div><button type="submit" class="btn">Daftar</button><div class="auth-switch"><a id="show-login-form">Sudah punya akun? Login</a></div></form>`;
            toggleModal(true, "Daftar Akun Baru", content);
          },
          renderProfileView: () => {
            const content = `<div class="profile-view"><p>Login sebagai: <span>${currentUser.name}</span></p><p>Email: ${currentUser.email}</p><button class="btn btn-logout" id="logout-btn">Logout</button></div>`;
            toggleModal(true, "Profil Anda", content);
          },
        };

        const checkoutLogic = {
          renderForm: () => {
            if (!currentUser) {
              showToast("Harap login terlebih dahulu untuk checkout.", "error");
              auth.renderLoginForm();
              return;
            }
            let summaryHTML = "<h4>Ringkasan Pesanan</h4>";
            let total = 0;
            cart.forEach((item) => {
              const product = products.find((p) => p.id === item.id);
              total += product.price * item.quantity;
              summaryHTML += `<div class="summary-item"><span>${
                item.quantity
              }x ${product.title}</span><span>${formatRupiah(
                product.price * item.quantity
              )}</span></div>`;
            });
            summaryHTML += `<div class="summary-item"><strong>Total</strong><strong>${formatRupiah(
              total
            )}</strong></div>`;

            const content = `<form class="checkout-form" id="checkout-form" novalidate>
                    <div class="checkout-summary">${summaryHTML}</div>
                    <div class="form-group"><label for="address">Alamat Pengiriman</label><textarea id="address" rows="3" required></textarea></div>
                    <div class="form-group"><label for="phone">Nomor Telepon</label><input type="tel" id="phone" required></div>
                    <button type="submit" class="btn">Lanjutkan ke Pembayaran</button>
                    </form>`;
            toggleModal(true, "Checkout", content);
          },
          process: (form) => {
            const button = form.querySelector('button[type="submit"]');
            let isValid = true;
            form.querySelectorAll("[required]").forEach((input) => {
              input.classList.remove("invalid");
              if (!input.value.trim()) {
                isValid = false;
                input.classList.add("invalid");
              }
            });
            if (!isValid) {
              showToast("Harap lengkapi alamat dan nomor telepon.", "error");
              return;
            }

            button.classList.add("loading");

            const totalAmount = cart.reduce((sum, item) => {
              const product = products.find((p) => p.id === item.id);
              return sum + product.price * item.quantity;
            }, 0);

            const orderData = {
              orderId: "ORDER-" + new Date().getTime(),
              totalAmount: totalAmount,
              customerDetails: {
                name: currentUser.name,
                email: currentUser.email,
                phone: form.querySelector("#phone").value,
              },
            };

            fetch("http://localhost:3000/create-transaction", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(orderData),
            })
              .then((response) => response.json())
              .then((data) => {
                button.classList.remove("loading");
                if (data.token) {
                  window.snap.pay(data.token, {
                    onSuccess: function (result) {
                      showToast("Pembayaran Berhasil!", "success");
                      cart = [];
                      cartLogic.save();
                      cartLogic.syncCounters();
                      toggleModal(false);
                    },
                    onPending: function (result) {
                      showToast("Menunggu Pembayaran Anda...");
                      toggleModal(false);
                    },
                    onError: function (result) {
                      showToast("Pembayaran Gagal.", "error");
                    },
                    onClose: function () {
                      /* User closed the popup */
                    },
                  });
                } else {
                  showToast("Gagal memproses pembayaran.", "error");
                }
              })
              .catch((error) => {
                button.classList.remove("loading");
                toggleModal(false);
                setTimeout(() => {
                  toggleModal(
                    true,
                    "Simulasi Gagal",
                    '<p style="text-align:center; padding: 1rem 0;">Gagal terhubung ke server backend. Pastikan server `node server.js` Anda sudah berjalan. Halaman pembayaran Midtrans tidak dapat ditampilkan.</p>'
                  );
                }, 500);
                console.error("Error connecting to backend:", error);
              });
          },
        };

        document.body.addEventListener("click", (e) => {
          const delegate = (selector, fn) => {
            if (e.target.closest(selector)) fn(e.target.closest(selector));
          };

          if (e.target.matches("#modal-overlay")) {
            toggleModal(false);
            return;
          }

          delegate(".close-btn", () => toggleModal(false));
          delegate(".logo, #mobile-home-btn", () => showView(DOM.homeView));
          delegate(".product-card", (el) =>
            showDetailPage(parseInt(el.dataset.id))
          );
          delegate(".btn-back", () => showView(DOM.homeView));
          delegate(".detail-actions .btn-primary", (el) =>
            cartLogic.add(
              parseInt(el.dataset.id),
              parseInt(document.getElementById("quantity-input").value)
            )
          );
          delegate(".quantity-btn", (el) => {
            const input = el.parentElement.querySelector("input");
            let value = parseInt(input.value);
            if (el.dataset.action === "increase") value++;
            if (el.dataset.action === "decrease" && value > 1) value--;
            input.value = value;
          });
          delegate(".category-card", (el) => {
            DOM.productSectionTitle.textContent =
              el.querySelector("h3").textContent;
            displayProducts(
              el.dataset.category === "all"
                ? products
                : products.filter((p) => p.category === el.dataset.category)
            );
            document.querySelector(".product-section").scrollIntoView();
          });
          delegate("#search-btn, #mobile-search-btn", () =>
            toggleOverlay(document.getElementById("search-overlay"), true)
          );
          delegate("#close-search-btn", () =>
            toggleOverlay(document.getElementById("search-overlay"), false)
          );
          delegate("#cart-btn, #mobile-cart-btn", cartLogic.renderModal);
          delegate("#user-btn, #mobile-user-btn", () =>
            currentUser ? auth.renderProfileView() : auth.renderLoginForm()
          );
          delegate("#show-register-form", auth.renderRegisterForm);
          delegate("#show-login-form", auth.renderLoginForm);
          delegate("#logout-btn", auth.logout);
          delegate("#checkout-btn", checkoutLogic.renderForm);

          const cartActionTarget = e.target.closest(
            ".cart-item-controls button"
          );
          if (cartActionTarget) {
            const id = parseInt(cartActionTarget.dataset.id);
            const action = cartActionTarget.dataset.action;
            const item = cart.find((i) => i.id === id);
            if (action === "increase" && item)
              cartLogic.updateQuantity(id, item.quantity + 1);
            if (action === "decrease" && item)
              cartLogic.updateQuantity(id, item.quantity - 1);
            if (action === "remove") cartLogic.remove(id);
          }
        });

        document.body.addEventListener("submit", (e) => {
          e.preventDefault();
          if (e.target.id === "login-form") auth.process(e.target, "login");
          if (e.target.id === "register-form")
            auth.process(e.target, "register");
          if (e.target.id === "checkout-form") checkoutLogic.process(e.target);
        });

        document
          .getElementById("search-input")
          .addEventListener("input", (e) => {
            const term = e.target.value.toLowerCase();
            displayProducts(
              products.filter((p) => p.title.toLowerCase().includes(term))
            );
            if (DOM.detailView.classList.contains("active"))
              showView(DOM.homeView);
            document.querySelector(".product-section").scrollIntoView();
          });

        displayProducts(products);
        showView(DOM.homeView);
        gsap.set(DOM.homeView, { autoAlpha: 1 });
        gsap.from(".desktop-header", {
          duration: 1,
          y: -100,
          opacity: 0,
          ease: "power3.out",
        });
        gsap.from(".hero-content > *", {
          duration: 1,
          y: 50,
          opacity: 0,
          stagger: 0.2,
          delay: 0.5,
          ease: "power3.out",
        });
        auth.updateUI();
        cartLogic.syncCounters();
      });
    </script>
  </body>
</html>
>>>>>>> 77412a3a2b58a18e57e1b9ab506fdbf612e6bf6a
